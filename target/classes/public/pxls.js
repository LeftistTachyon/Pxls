var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(k,r,u){if(u.get||u.set)throw new TypeError("ES3 does not support getters and setters.");k!=Array.prototype&&k!=Object.prototype&&(k[r]=u.value)};$jscomp.getGlobal=function(k){return"undefined"!=typeof window&&window===k?k:"undefined"!=typeof global&&null!=global?global:k};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(k){return $jscomp.SYMBOL_PREFIX+(k||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var k=$jscomp.global.Symbol.iterator;k||(k=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[k]&&$jscomp.defineProperty(Array.prototype,k,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(k){var r=0;return $jscomp.iteratorPrototype(function(){return r<k.length?{done:!1,value:k[r++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(k){$jscomp.initSymbolIterator();k={next:k};k[$jscomp.global.Symbol.iterator]=function(){return this};return k};$jscomp.makeIterator=function(k){$jscomp.initSymbolIterator();var r=k[Symbol.iterator];return r?r.call(k):$jscomp.arrayIterator(k)};$jscomp.arrayFromIterator=function(k){for(var r,u=[];!(r=k.next()).done;)u.push(r.value);return u};$jscomp.arrayFromIterable=function(k){return k instanceof Array?k:$jscomp.arrayFromIterator($jscomp.makeIterator(k))};
var instaban=!1;void 0!==window.App&&(instaban=!0);
window.App=function(){var k=function(a,b,c){var d=function(a,b,c){var e=new Date;b=escape(b);e.setDate(e.getDate()+c);b+=null===c?"":"; expires\x3d"+e.toUTCString();document.cookie=a+"\x3d"+b};return{haveSupport:null,support:function(){if(null===this.haveSupport)try{a.setItem("test",1),this.haveSupport=1==a.getItem("test"),a.removeItem("test")}catch(e){this.haveSupport=!1}return this.haveSupport},get:function(c){if(this.support())c=a.getItem(c);else a:{c=b+c;var e,d,D,f=document.cookie.split(";");
for(e=0;e<f.length;e++)if(d=f[e].substr(0,f[e].indexOf("\x3d")),D=f[e].substr(f[e].indexOf("\x3d")+1),d=d.replace(/^\s+|\s+$/g,""),d==c){c=unescape(D);break a}c=void 0}void 0===c&&(c=null);try{return JSON.parse(c)}catch(R){return null}},set:function(e,g){g=JSON.stringify(g);this.support()?a.setItem(e,g):d(b+e,g,c)},remove:function(c){this.support()?a.removeItem(c):d(b+c,"",-1)}}},r=function(a,b,c){var d=new XMLHttpRequest;d.open("GET",a,!0);d.responseType="arraybuffer";d.onload=function(a){4==d.readyState&&
(200==d.status?d.response&&(a=new Uint8Array(d.response),b(a)):c&&c())};d.send(null)},u=function(a,b){try{return new ImageData(a,b)}catch(d){var c=document.createElement("canvas");c.width=a;c.height=b;return c.getContext("2d").getImageData(0,0,a,b)}},x=function(){window.ga&&window.ga.apply(this,arguments)},y=navigator.userAgent,B=function(){var a=function(a,c,d,e){var b=document.createElement("div");return c&&(b.style.imageRendering=a+"crisp-edges",b.style.imageRendering===a+"crisp-edges")||d&&(b.style.imageRendering=
a+"pixelated",b.style.imageRendering===a+"pixelated")||e&&(b.style.imageRendering=a+"optimize-contrast",b.style.imageRendering===a+"optimize-contrast")?!0:!1};return a("",!0,!0,!1)||a("-o-",!0,!1,!1)||a("-moz-",!0,!1,!1)||a("-webkit-",!0,!1,!0)}(),F=!1,L=y.match(/(iPod|iPhone|iPad)/i)&&y.match(/AppleWebKit/i),Q=y.match(/safari/i)&&!y.match(/chrome/i),y=-1<y.indexOf("Edge");L?(L=parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined",
"3_2").replace("_",".").replace("_",""))||!1,B=!1,11<=L&&(F=!0)):Q&&(B=!1,F=!0);y&&(B=!1);var f=k(localStorage,"ls_",99),E=k(sessionStorage,"ss_",null),n=function(){var a={params:{},initialized:!1,_trigger:function(a,c,d){$(window).trigger("pxls:queryUpdated",[a,c,d])},_update:function(b){var c=window.location.hash.substring(1);0<window.location.search.length&&(c+="\x26"+window.location.search.substring(1));var d={};c.split("\x26").forEach(function(a){a=a.split("\x3d");var b=a.shift().toLowerCase();
b.length&&(d[b]=a.shift())});for(var e=Object.keys(d),c=0;c<e.length;c++){var g=e[c],f=d[g];if(!0===b){if(!a.params.hasOwnProperty(g)||a.params[g]!==d[g]){var D=a.params[g];a.params[g]=null==d[g]?null:d[g].toString();a._trigger(g,D,f)}}else a.params.hasOwnProperty(g)||(a.params[g]=d[g])}!0===b&&Object.keys(a.params).filter(function(a){return!e.includes(a)}).forEach(function(b){return a.remove(b)});window.location.search.substring(1)&&(window.location=window.location.pathname+"#"+a.getStr())},setIfDifferent:function(b,
c,d){var e={},g=!1;"string"===typeof b?(g=d,e[b]=c):"object"===typeof b&&(e=b,g=c);g=null==g?!1:!0===g;b=Object.entries(e);for(c=0;c<b.length;c++)d=b[c][0],e=b[c][1].toString(),a.get(d)!==e&&a.set(d,e,g)},init:function(){E.get("url_params")?(window.location.hash=E.get("url_params"),E.remove("url_params")):(a._update(),"replaceState"in window.history&&(window.onhashchange=function(){a._update(!0)}));$(window).on("message",function(a){a=a.originalEvent;if(a.data&&a.data.type&&a.data.data)switch(a=a.data,
a.type.toUpperCase().trim()){case "TEMPLATE_UPDATE":q.queueUpdate(a.data);break;case "VIEWPORT_UPDATE":p.updateViewport(a.data);break;default:console.warn("Unknown data type: %o",a.type)}})},has:function(b){return null!=a.get(b)},getStr:function(){var b=[],c;for(c in a.params)if(a.params.hasOwnProperty(c)){var d=encodeURIComponent(c);if(null!==a.params[c]){var e=decodeURIComponent(a.params[c]),g=a.params[c];e===g&&(g=encodeURIComponent(g));d+="\x3d"+g}b.push(d)}return b.join("\x26")},update:function(){var b=
a.getStr();window.history.replaceState?window.history.replaceState(null,null,"#"+b):window.location.hash=b},set:function(b,c,d){var e=a.params[b];a.params[b]=c.toString();!0!==d&&a._trigger(b,e,c.toString());a.lazy_update()},get:function(b){return a.params[b]},remove:function(b,c){delete a.params[b];a.lazy_update();!0!==c&&a._trigger(b,a.params[b],null)},timer:null,lazy_update:function(){null!==a.timer&&clearTimeout(a.timer);a.timer=setTimeout(function(){a.timer=null;a.update()},200)}};return{init:a.init,
get:a.get,set:a.setIfDifferent,has:a.has,update:a.update,remove:a.remove,lazy_update:a.lazy_update}}(),z=function(){var a={bad_src:[/^https?:\/\/[^\/]*raw[^\/]*git[^\/]*\/(metonator|Deklost|NomoX|RogerioBlanco)/gi,/^chrome\-extension:\/\/lmleofkkoohkbgjikogbpmnjmpdedfil/gi,/^https?:\/\/.*mlpixel\.org/gi],bad_events:["mousedown","mouseup","click"],checkSrc:function(b){for(var c=0;c<a.bad_src.length;c++)b.match(a.bad_src[c])&&a.shadow()},init:function(){setInterval(a.update,5E3);var b=window.WebSocket;
window.WebSocket=function(c,e){a.shadow();return new b(c,e)};window.MouseEvent=function(){a.me(2)};var c=window.Event;window.Event=function(b,e){-1!==a.bad_events.indexOf(b.toLowerCase())&&a.shadow();return new c(b,e)};var d=window.CustomEvent;window.CustomEvent=function(b,c){-1!==a.bad_events.indexOf(b.toLowerCase())&&a.shadow();return new d(b,c)};var e=window.document.createEvent;document.createEvent=function(b,c){-1!==a.bad_events.indexOf(b.toLowerCase())&&a.shadow();return e(b,c)};$(window).on("DOMNodeInserted",
function(b){"SCRIPT"==b.target.nodeName&&a.checkSrc(b.target.src)});$("script").map(function(){a.checkSrc(this.src)})},shadow:function(){h.send('{"type":"shadowbanme"}')},me:function(a){h.send('{"type":"banme", "app": "'+String((void 0===a?0:a)>>0).substr(0,2)+'"}');h.close();window.location.href="https://www.youtube.com/watch?v\x3dQHvKSo4BFi0"},update:function(){var b=function(){a.me(1)};window.App.attemptPlace=window.App.doPlace=function(){a.me(3)};document.autoPxlsScriptRevision&&b();document.autoPxlsScriptRevision_&&
b();document.autoPxlsRandomNumber&&b();document.RN&&b();window.AutoPXLS&&b();window.AutoPXLS2&&b();document.defaultCaptchaFaviconSource&&b();window.CFS&&b();$("div.info").find("#autopxlsinfo").length&&b();window.xD&&b();window.vdk&&b();$(".botpanel").length&&b();window.Notabot&&b();window.Botnet&&b();window.DrawIt&&b();window.NomoXBot&&b()}};return{init:a.init,shadow:a.shadow,me:a.me}}(),h=function(){var a={ws:null,ws_constructor:WebSocket,hooks:[],sendQueue:[],wps:WebSocket.prototype.send,wpc:WebSocket.prototype.close,
ws_open_state:WebSocket.OPEN,reconnect:function(){$("#reconnecting").show();setTimeout(function(){$.get(window.location.pathname+"?_"+(new Date).getTime(),function(){window.location.reload()}).fail(function(){console.log("Server still down...");a.reconnect()})},3E3)},reconnectSocket:function(){a.ws.onclose=function(){};a.connectSocket()},connectSocket:function(){var b=window.location;a.ws=new a.ws_constructor(("https:"===b.protocol?"wss://":"ws://")+b.host+b.pathname+"ws");a.ws.onopen=function(b){setTimeout(function(){for(;0<
a.sendQueue.length;){var b=a.sendQueue.shift();a.send(b)}},0)};a.ws.onmessage=function(b){var c=JSON.parse(b.data);$.map(a.hooks,function(a){a.type===c.type&&a.fn(c)})};a.ws.onclose=function(){a.reconnect()}},init:function(){null===a.ws&&(a.connectSocket(),$(window).on("beforeunload",function(){a.ws.onclose=function(){};a.close()}),$("#board-container").show(),$("#ui").show(),$("#loading").fadeOut(500),t.wsinit())},on:function(b,c){a.hooks.push({type:b,fn:c})},close:function(){a.ws.close=a.wpc;a.ws.close()},
send:function(b){b="string"===typeof b?b:JSON.stringify(b);null==a.ws||a.ws.readyState!==a.ws_open_state?a.sendQueue.push(b):(a.ws.send=a.wps,a.ws.send(b))}};return{init:a.init,on:a.on,send:a.send,close:a.close,reconnect:a.reconnect,reconnectSocket:a.reconnectSocket}}(),p=function(){var a={elements:{board:$("#board"),board_render:null,mover:$("#board-mover"),zoomer:$("#board-zoomer"),container:$("#board-container")},ctx:null,use_js_render:!B&&!F,use_zoom:!B&&F,width:0,height:0,scale:1,id:null,intView:null,
pan:{x:0,y:0},allowDrag:!0,pannedWithKeys:!1,rgbPalette:[],loaded:!1,pixelBuffer:[],holdTimer:{id:-1,holdTimeout:500,handler:function(b){a.holdTimer.id=-1;A.runLookup(b.x,b.y)}},updateViewport:function(b){isNaN(b.scale)||(a.scale=parseFloat(b.scale));a.centerOn(b.x,b.y)},centerOn:function(b,c){null!=b&&(a.pan.x=a.width/2-b);null!=c&&(a.pan.y=a.height/2-c);a.update()},replayBuffer:function(){$.map(a.pixelBuffer,function(b){a.setPixel(b.x,b.y,b.c,!1)});a.refresh();a.pixelBuffer=[]},draw:function(b){a.id=
u(a.width,a.height);a.ctx.mozImageSmoothingEnabled=a.ctx.webkitImageSmoothingEnabled=a.ctx.msImageSmoothingEnabled=a.ctx.imageSmoothingEnabled=!1;a.intView=new Uint32Array(a.id.data.buffer);a.rgbPalette=m.getPaletteRGB();for(var c=0;c<a.width*a.height;c++)a.intView[c]=255==b[c]?0:a.rgbPalette[b[c]];a.ctx.putImageData(a.id,0,0);a.update();a.loaded=!0;a.replayBuffer()},initInteraction:function(){function b(b){b.target&&!b.target.closest(".panel")&&$("#txtChatContent").blur();var c,d,f=!0;b.changedTouches&&
b.changedTouches[0]?(c=b.changedTouches[0].clientX,d=b.changedTouches[0].clientY):(c=b.clientX,d=b.clientY,null!=b.button&&(f=0===b.button));e=c;g=d;f&&-1===a.holdTimer.id&&(a.holdTimer.id=setTimeout(a.holdTimer.handler,a.holdTimer.holdTimeout,{x:c,y:d}));G=Date.now()}function c(b){if(-1!==a.holdTimer.id){var c;b.changedTouches&&b.changedTouches[0]?(c=b.changedTouches[0].clientX,b=b.changedTouches[0].clientY):(c=b.clientX,b=b.clientY);if(5<Math.abs(e-c)||5<Math.abs(g-b))clearTimeout(a.holdTimer.id),
a.holdTimer.id=-1}}var d=function(b){a.allowDrag&&(a.pan.x+=b.dx/a.scale,a.pan.y+=b.dy/a.scale,a.update())};interact(a.elements.container[0]).draggable({inertia:!0,onmove:d}).gesturable({onmove:function(b){a.scale*=1+b.ds;d(b)}});$(document.body).on("keydown",function(b){switch(b.originalEvent.code||b.keyCode||b.which||b.key){case "KeyW":case "ArrowUp":case 38:case 87:case "w":case "W":a.pan.y+=100/a.scale;break;case "KeyD":case "ArrowRight":case 39:case 68:case "d":case "D":a.pan.x-=100/a.scale;
break;case "KeyS":case "ArrowDown":case 40:case 83:case "s":case "S":a.pan.y-=100/a.scale;break;case "KeyA":case "ArrowLeft":case 37:case 65:case "a":case "A":a.pan.x+=100/a.scale;break;case "KeyP":case 80:case "p":case "P":a.save();break;case "KeyL":case 76:case "l":case "L":a.allowDrag=!a.allowDrag;a.allowDrag?C.lockIcon.fadeOut(200):C.lockIcon.fadeIn(200);break;case "KeyR":case 82:case "r":case "R":b=q.getOptions();var c=$("#board-template");b.use&&p.centerOn(b.x+c.width()/2,b.y+c.height()/2);
break;case "KeyJ":case 74:case "j":case "J":1>m.color?m.switch(m.getPaletteRGB().length-1):m.switch(m.color-1);break;case "KeyK":case 75:case "k":case "K":m.color+1>=m.getPaletteRGB().length?m.switch(0):m.switch(m.color+1);break;case "KeyE":case "Equal":case "NumpadAdd":case 69:case 107:case 187:case 171:case "\x3d":case "e":case "E":a.nudgeScale(1);break;case "KeyQ":case "Minus":case "NumpadSubtact":case 81:case 109:case 173:case 189:case "q":case "Q":case "-":a.nudgeScale(-1);break;case "t":case "T":case "KeyT":case 84:I.open("settings");
break;case "i":case "I":case "KeyI":case 73:I.open("info");break;case "b":case "B":case "KeyB":case 66:I.open("chat")}a.pannedWithKeys=!0;a.update()});a.elements.container[0].addEventListener("wheel",function(b){if(a.allowDrag){var c=a.scale;0<b.deltaY?a.nudgeScale(-1):a.nudgeScale(1);if(c!==a.scale){var e=b.clientX-a.elements.container.width()/2;b=b.clientY-a.elements.container.height()/2;a.pan.x-=e/c;a.pan.x+=e/a.scale;a.pan.y-=b/c;a.pan.y+=b/a.scale;a.update();m.update()}}},{passive:!0});var e,
g,G;a.elements.board_render.on("pointerdown mousedown",b).on("pointermove mousemove",c).on("pointerup mouseup touchend",function(b){-1!==a.holdTimer.id&&clearTimeout(a.holdTimer.id);if(!0!==b.shiftKey){a.holdTimer.id=-1;var c=!1,d=b.clientX,D=b.clientY,h=Date.now()-G;"touchend"===b.type&&(c=!0,d=b.changedTouches[0].clientX,D=b.changedTouches[0].clientY);var k=Math.abs(e-d),l=Math.abs(g-D);(0===b.button||c)&&500>h&&(!a.allowDrag&&25>k&&25>l?(c=a.fromScreen(e,g),m.place(c.x|0,c.y|0)):5>k&&5>l&&(c=a.fromScreen(d,
D),m.place(c.x|0,c.y|0)));null!=b.button&&!0===f.get("enableMiddleMouseSelect")&&1===b.button&&15>k&&15>l&&(b=a.fromScreen(b.clientX,b.clientY),m.switch(a.getPixel(b.x,b.y)))}}).contextmenu(function(a){a.preventDefault();m.switch(-1)});a.elements.board_render[0].addEventListener("touchstart",b,{passive:!1});a.elements.board_render[0].addEventListener("touchmove",c,{passive:!1})},init:function(){$(window).on("pxls:queryUpdated",function(a,c,d,e){switch(c.toLowerCase()){case "x":case "y":p.centerOn(n.get("x")>>
0,n.get("y")>>0);break;case "scale":p.setScale(e>>0);break;case "template":q.queueUpdate({template:e,use:null!==e});break;case "ox":q.queueUpdate({ox:null===e?null:e>>0});break;case "oy":q.queueUpdate({oy:null===e?null:e>>0});break;case "tw":q.queueUpdate({tw:null===e?null:e>>0});break;case "oo":a=parseFloat(e),Number.isFinite(a)||(a=null),q.queueUpdate({oo:null===a?null:a})}});$("#ui").hide();a.elements.container.hide();a.use_js_render?(a.elements.board_render=$("\x3ccanvas\x3e").css({width:"100vw",
height:"100vh",margin:0,marginTop:3}),a.elements.board.parent().append(a.elements.board_render),a.elements.board.detach()):a.elements.board_render=a.elements.board;a.ctx=a.elements.board[0].getContext("2d");a.initInteraction();$("#snapshotImageFormat").val(f.get("snapshotImageFormat")||"image/png");$("#snapshotImageFormat").on("change input",function(a){f.set("snapshotImageFormat",a.target.value)})},start:function(){$.get("/info",function(b){M.webinit(b);N.webinit(b);t.webinit(b);a.width=b.width;
a.height=b.height;m.setPalette(b.palette);v.setMax(b.maxStacked);b.captchaKey&&($(".g-recaptcha").attr("data-sitekey",b.captchaKey),$.getScript("https://www.google.com/recaptcha/api.js"));a.elements.board.attr({width:a.width,height:a.height});b=n.get("x")||a.width/2;var c=n.get("y")||a.height/2;a.scale=n.get("scale")||a.scale;a.centerOn(b,c);h.init();r("/boarddata?_"+(new Date).getTime(),a.draw,h.reconnect);a.use_js_render?$(window).resize(function(){a.update()}).resize():$(window).resize(function(){m.update();
J.update()});(b=n.get("template"))&&q.queueUpdate({use:!0,x:parseFloat(n.get("ox")),y:parseFloat(n.get("oy")),opacity:parseFloat(n.get("oo")),width:parseFloat(n.get("tw")),url:b});var d=parseFloat(n.get("spin"));if(d){var d=360/(1E3*d),e=0,g=null,G=function(b){g||(g=b);e+=d*(b-g);e%=360;g=b;a.elements.container.css("transform","rotate("+e+"deg)");window.requestAnimationFrame(G)};window.requestAnimationFrame(G)}b=f.get("color");null!=b&&m.switch(parseInt(b))}).fail(function(){h.reconnect()})},update:function(b){a.pan.x=
Math.min(a.width/2,Math.max(-a.width/2,a.pan.x));a.pan.y=Math.min(a.height/2,Math.max(-a.height/2,a.pan.y));n.set({x:Math.round(a.width/2-a.pan.x),y:Math.round(a.height/2-a.pan.y),scale:Math.round(100*a.scale)/100},!0);if(a.use_js_render){b=a.elements.board_render[0].getContext("2d");var c=-a.pan.x+(a.width-window.innerWidth/a.scale)/2,d=-a.pan.y+(a.height-window.innerHeight/a.scale)/2,e=0,g=0,f=0,k=0,h=window.innerWidth/a.scale,l=window.innerHeight/a.scale;0>c&&(e=-c,c=0,h-=e,f+=e);0>d&&(g=-d,d=
0,l-=g,k+=g);c+h>a.width&&(f+=h+c-a.width,h=a.width-c);d+l>a.height&&(k+=l+d-a.height,l=a.height-d);b.canvas.width=window.innerWidth;b.canvas.height=window.innerHeight;b.mozImageSmoothingEnabled=b.webkitImageSmoothingEnabled=b.msImageSmoothingEnabled=b.imageSmoothingEnabled=1>Math.abs(a.scale);b.globalAlpha=1;b.fillStyle="#CCCCCC";b.fillRect(0,0,b.canvas.width,b.canvas.height);b.drawImage(a.elements.board[0],c,d,h,l,0+e*a.scale,0+g*a.scale,window.innerWidth-f*a.scale,window.innerHeight-k*a.scale);
q.draw(b,c,d);m.update();J.update();return!0}if(b)return!1;1>Math.abs(a.scale)?a.elements.board.removeClass("pixelate"):a.elements.board.addClass("pixelate");(a.allowDrag||!a.allowDrag&&a.pannedWithKeys)&&a.elements.mover.css({width:a.width,height:a.height,transform:"translate("+(1>=a.scale?Math.round(a.pan.x):a.pan.x)+"px, "+(1>=a.scale?Math.round(a.pan.y):a.pan.y)+"px)"});a.use_zoom?a.elements.zoomer.css("zoom",(100*a.scale).toString()+"%"):a.elements.zoomer.css("transform","scale("+a.scale+")");
m.update();J.update();return!0},getScale:function(){return Math.abs(a.scale)},setScale:function(b){!0!==f.get("increased_zoom")&&50<b?b=50:0>=b&&(b=.5);a.scale=b;a.update()},nudgeScale:function(b){var c=Math.abs(a.scale),d=Math.sign(a.scale),e=!0===f.get("increased_zoom");-1===b?a.scale=1>=c?.5:2>=c?1:Math.round(Math.max(2,c/1.25)):.5===c?a.scale=1:1===c?a.scale=2:(b=1.25*c,e&&50<=c&&(b=1.15*c),b=Math.ceil(b),a.scale=e?b:Math.round(Math.min(50,b)));a.scale*=d;a.update()},getPixel:function(b,c){b=
Math.floor(b);c=Math.floor(c);return a.rgbPalette.indexOf(a.intView[c*a.width+b])},setPixel:function(b,c,d,e){a.loaded?(void 0===e&&(e=!0),a.intView[c*a.width+b]=-1==d||255==d?0:a.rgbPalette[d],e&&a.ctx.putImageData(a.id,0,0)):a.pixelBuffer.push({x:b,y:c,c:d})},refresh:function(){a.loaded&&a.ctx.putImageData(a.id,0,0)},fromScreen:function(b,c){var d=0,e=0;0>a.scale&&(d=a.width,e=a.height);if(a.use_js_render)return{x:-a.pan.x+(a.width-window.innerWidth/a.scale)/2+b/a.scale+d,y:-a.pan.y+(a.height-window.innerHeight/
a.scale)/2+c/a.scale+e};var g=a.elements.board[0].getBoundingClientRect();return a.use_zoom?{x:b/a.scale-g.left+d,y:c/a.scale-g.top+e}:{x:(b-g.left)/a.scale+d,y:(c-g.top)/a.scale+e}},toScreen:function(b,c){0>a.scale&&(b-=a.width-1,c-=a.height-1);if(a.use_js_render)return{x:(b+a.pan.x-(a.width-window.innerWidth/a.scale)/2)*a.scale,y:(c+a.pan.y-(a.height-window.innerHeight/a.scale)/2)*a.scale};var d=a.elements.board[0].getBoundingClientRect();return a.use_zoom?{x:(b+d.left)*a.scale,y:(c+d.top)*a.scale}:
{x:b*a.scale+d.left,y:c*a.scale+d.top}},save:function(){var b=document.createElement("a"),c=$("#snapshotImageFormat").val();b.href=a.elements.board[0].toDataURL(c,1);b.download=(new Date).toISOString().replace(/^(\d+-\d+-\d+)T(\d+):(\d+):(\d).*$/,"pxls canvas $1 $2.$3.$4."+c.split("/")[1]);document.body.appendChild(b);b.click();document.body.removeChild(b);"function"===typeof b.remove&&b.remove()},getRenderBoard:function(){return a.elements.board_render}};return{init:a.init,start:a.start,update:a.update,
getScale:a.getScale,nudgeScale:a.nudgeScale,setScale:a.setScale,getPixel:a.getPixel,setPixel:a.setPixel,fromScreen:a.fromScreen,toScreen:a.toScreen,save:a.save,centerOn:a.centerOn,getRenderBoard:a.getRenderBoard,refresh:a.refresh,updateViewport:a.updateViewport,allowDrag:a.allowDrag}}(),M=function(){var a={elements:{heatmap:$("#heatmap"),heatmapLoadingBubble:$("#heatmapLoadingBubble")},ctx:null,id:null,intView:null,width:0,height:0,lazy_inited:!1,is_shown:!1,color:6053069,loop:function(){for(var b=
0;b<a.width*a.height;b++){var c=a.intView[b]>>24;c&&(c--,a.intView[b]=c<<24|a.color)}a.ctx.putImageData(a.id,0,0);setTimeout(a.loop,1E3*a.seconds/256)},lazy_init:function(){a.lazy_inited?a.elements.heatmapLoadingBubble.hide():(a.elements.heatmapLoadingBubble.show(),a.lazy_inited=!0,r("/heatmap?_"+(new Date).getTime(),function(b){a.ctx=a.elements.heatmap[0].getContext("2d");a.ctx.mozImageSmoothingEnabled=a.ctx.webkitImageSmoothingEnabled=a.ctx.msImageSmoothingEnabled=a.ctx.imageSmoothingEnabled=!1;
a.id=u(a.width,a.height);a.intView=new Uint32Array(a.id.data.buffer);for(var c=0;c<a.width*a.height;c++)a.intView[c]=b[c]<<24|a.color;a.ctx.putImageData(a.id,0,0);a.elements.heatmap.fadeIn(200);a.elements.heatmapLoadingBubble.hide();setTimeout(a.loop,1E3*a.seconds/256);h.on("pixel",function(b){a.ctx.fillStyle="#CD5C5C";$.map(b.pixels,function(b){a.ctx.fillRect(b.x,b.y,1,1);a.intView[b.y*a.width+b.x]=4278190080|a.color})})}))},clear:function(){a._clear()},_clear:function(){if(null!=a.intView){for(var b=
0;b<a.width*a.height;b++)a.intView[b]=0;a.ctx.putImageData(a.id,0,0)}},setBackgroundOpacity:function(b){"string"===typeof b&&(b=parseFloat(b),isNaN(b)&&(b=.5));if(null===b||void 0===b)b=.5;if(0>b||1<b)b=.5;f.set("heatmap_background_opacity",b);a.elements.heatmap.css("background-color","rgba(0, 0, 0, "+b+")")},init:function(){a.elements.heatmap.hide();a.elements.heatmapLoadingBubble.hide();a.setBackgroundOpacity(f.get("heatmap_background_opacity"));$("#heatmap-opacity").val(f.get("heatmap_background_opacity"));
$("#heatmap-opacity").on("change input",function(){a.setBackgroundOpacity(parseFloat(this.value))});$("#hvmapClear").click(function(){a.clear()});$(window).keydown(function(b){"o"!=b.key&&"O"!=b.key&&79!=b.which||a.clear()})},show:function(){a.is_shown=!1;a.toggle()},hide:function(){a.is_shown=!0;a.toggle()},toggle:function(){a.is_shown=!a.is_shown;f.set("heatmap",a.is_shown);$("#heatmaptoggle")[0].checked=a.is_shown;a.lazy_inited?a.is_shown?this.elements.heatmap.fadeIn(200):this.elements.heatmap.fadeOut(200):
a.is_shown&&a.lazy_init()},webinit:function(b){a.width=b.width;a.height=b.height;a.seconds=b.heatmapCooldown;a.elements.heatmap.attr({width:a.width,height:a.height});f.get("heatmap")&&a.show();$("#heatmaptoggle")[0].checked=f.get("heatmap");$("#heatmaptoggle").change(function(){this.checked?a.show():a.hide()});$(window).keydown(function(b){if("h"==b.key||"H"==b.key||72==b.which)a.toggle(),$("#heatmaptoggle")[0].checked=f.get("heatmap")})}};return{init:a.init,webinit:a.webinit,toggle:a.toggle,setBackgroundOpacity:a.setBackgroundOpacity,
clear:a.clear}}(),N=function(){var a={elements:{virginmap:$("#virginmap"),virginmapLoadingBubble:$("#virginmapLoadingBubble")},ctx:null,id:null,width:0,height:0,lazy_inited:!1,is_shown:!1,lazy_init:function(){a.lazy_inited?a.elements.virginmapLoadingBubble.hide():(a.elements.virginmapLoadingBubble.show(),a.lazy_inited=!0,r("/virginmap?_"+(new Date).getTime(),function(b){a.ctx=a.elements.virginmap[0].getContext("2d");a.ctx.mozImageSmoothingEnabled=a.ctx.webkitImageSmoothingEnabled=a.ctx.msImageSmoothingEnabled=
a.ctx.imageSmoothingEnabled=!1;a.id=u(a.width,a.height);a.ctx.putImageData(a.id,0,0);a.ctx.fillStyle="#000000";a.intView=new Uint32Array(a.id.data.buffer);for(var c=0;c<a.width*a.height;c++){var d=c%a.width,e=Math.floor(c/a.width);0===b[c]&&a.ctx.fillRect(d,e,1,1)}a.elements.virginmap.fadeIn(200);a.elements.virginmapLoadingBubble.hide();h.on("pixel",function(b){$.map(b.pixels,function(b){a.ctx.fillStyle="#000000";a.ctx.fillRect(b.x,b.y,1,1)})})}))},clear:function(){a._clear()},_clear:function(){a.ctx.putImageData(a.id,
0,0);a.ctx.fillStyle="#00FF00";a.ctx.fillRect(0,0,a.width,a.height)},setBackgroundOpacity:function(b){"string"===typeof b&&(b=parseFloat(b),isNaN(b)&&(b=.5));if(null===b||void 0===b)b=.5;if(0>b||1<b)b=.5;f.set("virginmap_background_opacity",b);a.elements.virginmap.css("background-color","rgba(0, 255, 0, "+b+")")},init:function(){a.elements.virginmap.hide();a.elements.virginmapLoadingBubble.hide();a.setBackgroundOpacity(f.get("virginmap_background_opacity"));$("#virginmap-opacity").val(f.get("virginmap_background_opacity"));
$("#virginmap-opacity").on("change input",function(){a.setBackgroundOpacity(parseFloat(this.value))});$("#hvmapClear").click(function(){a.clear()});$(window).keydown(function(b){"o"!=b.key&&"O"!=b.key&&79!=b.which||a.clear()})},show:function(){a.is_shown=!1;a.toggle()},hide:function(){a.is_shown=!0;a.toggle()},toggle:function(){a.is_shown=!a.is_shown;f.set("virginmap",a.is_shown);$("#virginmaptoggle")[0].checked=a.is_shown;a.lazy_inited?a.is_shown?this.elements.virginmap.fadeIn(200):this.elements.virginmap.fadeOut(200):
a.is_shown&&a.lazy_init()},webinit:function(b){a.width=b.width;a.height=b.height;a.seconds=b.virginmapCooldown;a.elements.virginmap.attr({width:a.width,height:a.height});f.get("virginmap")&&a.show();$("#virginmaptoggle")[0].checked=f.get("virginmap");$("#virginmaptoggle").change(function(){this.checked?a.show():a.hide()});$(window).keydown(function(b){if("x"==b.key||"X"==b.key||88==b.which)a.toggle(),$("#virginmaptoggle")[0].checked=f.get("virginmap")})}};return{init:a.init,webinit:a.webinit,toggle:a.toggle,
setBackgroundOpacity:a.setBackgroundOpacity,clear:a.clear}}(),q=function(){var a={elements:{template:null},queueTimer:0,_queuedUpdates:{},_defaults:{url:"",x:0,y:0,width:-1,opacity:.5},options:{},lazy_init:function(){if(null==a.elements.template){a.options.use=!0;var b=0,c=0;a.elements.template=$("\x3cimg\x3e").addClass("noselect pixelate").attr({id:"board-template",src:a.options.url,alt:"template"}).css({top:a.options.y,left:a.options.x,opacity:a.options.opacity,width:-1===a.options.width?"auto":
a.options.width}).data("dragging",!1).on("mousedown pointerdown",function(a){a.preventDefault();$(this).data("dragging",!0);b=a.clientX;c=a.clientY;a.stopPropagation()}).on("mouseup pointerup",function(a){a.preventDefault();$(this).data("dragging",!1);a.stopPropagation()}).on("mousemove pointermove",function(d){d.preventDefault();if($(this).data("dragging")){var e=p.fromScreen(b,c),g=p.fromScreen(d.clientX,d.clientY),f=(g.x|0)-(e.x|0),e=(g.y|0)-(e.y|0),g=a.options.x+f,h=a.options.y+e;a._update({x:g,
y:h});n.set({ox:g,oy:h},!0);0!=f&&(b=d.clientX);0!=e&&(c=d.clientY)}});p.update(!0)||p.getRenderBoard().parent().prepend(a.elements.template)}},update_drawer:function(){$("#template-use")[0].checked=a.options.use;$("#template-url").val(a.options.url);$("#template-opacity").val(a.options.opacity)},normalizeTemplateObj:function(a,c){var b=[["tw","width"],["ox","x"],["oy","y"],["oo","opacity"],["template","url"]];if(!0!==c)for(c=0;c<b.length;c++)b[c].reverse();for(c=0;c<b.length;c++){var e=b[c];e[0]in
a&&null==a[e[1]]&&(a[e[1]]=a[e[0]],delete a[e[0]])}return a},queueUpdate:function(b){b=a.normalizeTemplateObj(b,!0);a._queuedUpdates=Object.assign(a._queuedUpdates,b);a.queueTimer&&clearTimeout(a.queueTimer);a.queueTimer=setTimeout(function(){a._update(a._queuedUpdates);a._queuedUpdates={};a.queueTimer=0},200)},_update:function(b){var c=b.url!==a.options.url&&decodeURIComponent(b.url)!==a.options.url&&null!=b.url&&null!=a.options.url;null!=b.url&&0<b.url.length&&(b.url=decodeURIComponent(b.url));
c&&!a.options.use&&["width","x","y","opacity"].forEach(function(c){b.hasOwnProperty(c)||(b[c]=a._defaults[c])});b=Object.assign({},a._defaults,a.options,a.normalizeTemplateObj(b,!0));Object.keys(a._defaults).forEach(function(c){if(null==b[c]||"number"===typeof b[c]&&isNaN(b[c]))b[c]=a._defaults[c]});b.opacity=parseFloat(b.opacity.toFixed(2));a.options=b;0===b.url.length||!1===b.use?(a.options.use=!1,a.elements.template&&(a.elements.template.remove(),a.elements.template=null),p.update(!0),["template",
"ox","oy","oo","tw"].forEach(function(a){return n.remove(a,!0)})):(a.options.use=!0,!0===c&&null!=a.elements.template&&(a.elements.template.remove(),a.elements.template=null),a.lazy_init(),[["left","x"],["top","y"],["opacity","opacity"]].forEach(function(c){a.elements.template.css(c[0],b[c[1]])}),a.elements.template.css("width",0<b.width?b.width:"auto"),[["url","template"],["x","ox"],["y","oy"],["width","tw"],["opacity","oo"]].forEach(function(b){n.set(b[1],a.options[b[0]],!0)}));a.update_drawer()},
disableTemplate:function(){a._update({url:null})},draw:function(b,c,d){if(a.options.use){var e=a.elements.template[0].width,g=a.elements.template[0].height,f=p.getScale();-1!==a.options.width&&(g*=a.options.width/e,e=a.options.width);b.globalAlpha=a.options.opacity;b.drawImage(a.elements.template[0],(a.options.x-c)*f,(a.options.y-d)*f,e*f,g*f)}},init:function(){O.create("#template-control",84,"template_open",!1);$("#template-use").change(function(){a._update({use:this.checked})});$("#template-url").change(function(){a._update({url:this.value})}).keydown(function(a){"Enter"!=
a.key&&13!==a.which||$(this).change();"v"!=a.key&&"V"!=a.key&&86!=a.which||!a.ctrlKey||$(this).trigger("paste");a.stopPropagation()}).on("paste",function(){var b=this;setTimeout(function(){a._update({use:!0,url:b.value})},100)});$("#template-opacity").on("change input",function(){a._update({opacity:parseFloat(this.value)})});$(window).keydown(function(b){b.ctrlKey&&a.options.use&&(b.preventDefault(),a.elements.template.css("pointer-events","initial"));switch(b.code||b.keyCode||b.which||b.key){case "PageUp":case 33:b=
Math.min(1,a.options.opacity+.1);a._update({opacity:b});break;case "PageDown":case 34:b=Math.max(0,a.options.opacity-.1);a._update({opacity:b});break;case "KeyV":case 86:case "v":case "V":a._update({use:!a.options.use})}}).on("keyup blur",function(b){a.options.use&&a.elements.template.css("pointer-events","none").data("dragging",!1)})},getOptions:function(){return a.options}};return{normalizeTemplateObj:a.normalizeTemplateObj,update:a._update,draw:a.draw,init:a.init,queueUpdate:a.queueUpdate,getOptions:a.getOptions}}(),
J=function(){var a={elements:{grid:$("#grid")},init:function(){a.elements.grid.hide();$("#gridtoggle")[0].checked=f.get("view_grid");$("#gridtoggle").change(function(){f.set("view_grid",this.checked);a.elements.grid.fadeToggle({duration:100})});f.get("view_grid")&&a.elements.grid.fadeToggle({duration:100});$(document.body).on("keydown",function(a){if("g"==a.key||"G"==a.key||71===a.keyCode)$("#gridtoggle")[0].checked=!$("#gridtoggle")[0].checked,$("#gridtoggle").trigger("change")})},update:function(){var b=
p.fromScreen(0,0),c=p.getScale();a.elements.grid.css({backgroundSize:c+"px "+c+"px",transform:"translate("+Math.floor(-b.x%1*c)+"px,"+Math.floor(-b.y%1*c)+"px)",opacity:(c-2)/6})}};return{init:a.init,update:a.update}}(),m=function(){var a={elements:{palette:$("#palette"),cursor:$("#cursor"),reticule:$("#reticule"),undo:$("#undo")},undoTimeout:!1,palette:[],reticule:{x:0,y:0},audio:new Audio("place.wav"),color:-1,pendingPixel:{x:0,y:0,color:-1},autoreset:!0,setAutoReset:function(b){a.autoreset=b?!0:
!1;f.set("auto_reset",a.autoreset)},switch:function(b){a.color=b;f.set("color",b);$(".palette-color").removeClass("active");$("body").toggleClass("show-placeable-bubble",-1===b);if(-1===b)a.elements.cursor.hide(),a.elements.reticule.hide();else if(15>=a.scale&&a.elements.cursor.show(),a.elements.cursor.css("background-color",a.palette[b]),a.elements.reticule.css("background-color",a.palette[b]),-1!==b){$($(".palette-color[data-idx\x3d"+b+"],.palette-color[data-idx\x3d-1]")).addClass("active");try{$('.palette-color[data-idx\x3d"'+
b+'"]')[0].scrollIntoView({block:"nearest",inline:"nearest"})}catch(c){$('.palette-color[data-idx\x3d"'+b+'"]')[0].scrollIntoView(!1)}}},place:function(b,c){w.cooledDown()&&-1!==a.color&&a._place(b,c)},_place:function(b,c){a.pendingPixel.x=b;a.pendingPixel.y=c;a.pendingPixel.color=a.color;h.send({type:"pixel",x:b,y:c,color:a.color});x("send","event","Pixels","Place");a.autoreset&&a.switch(-1)},update:function(b,c){void 0!==b&&(b=p.fromScreen(b,c),a.reticule={x:b.x|=0,y:b.y|=0});-1===a.color?(a.elements.reticule.hide(),
a.elements.cursor.hide()):(b=p.toScreen(a.reticule.x,a.reticule.y),c=p.getScale(),a.elements.reticule.css({left:b.x-1,top:b.y-1,width:c-1,height:c-1}).show(),a.elements.cursor.show())},setNumberedPaletteEnabled:function(b){a.elements.palette[0].classList.toggle("no-pills",!b)},setPalette:function(b){a.palette=b;a.elements.palette.find(".palette-color").remove().end().append($.map(a.palette,function(b,d){return $("\x3cdiv\x3e").attr("data-idx",d).addClass("palette-color").addClass("ontouchstart"in
window?"touch":"no-touch").css("background-color",a.palette[d]).append($("\x3cspan\x3e").addClass("palette-number").text(d)).click(function(){(!1===f.get("auto_reset")||w.cooledDown())&&a.switch(d)})}));a.elements.palette.prepend($("\x3cdiv\x3e").attr("data-idx",-1).addClass("palette-color no-border deselect-button").addClass("ontouchstart"in window?"touch":"no-touch").css("background-color","transparent").append(crel("i",{class:"fas fa-times"})).click(function(){a.switch(-1)}))},can_undo:!1,undo:function(b){b.stopPropagation();
h.send({type:"undo"});a.can_undo=!1;document.body.classList.remove("undo-visible");a.elements.undo.removeClass("open")},init:function(){a.elements.reticule.hide();a.elements.cursor.hide();document.body.classList.remove("undo-visible");a.elements.undo.removeClass("open");p.getRenderBoard().on("pointermove mousemove",function(b){a.update(b.clientX,b.clientY)});$(window).on("pointermove mousemove touchstart touchmove",function(b){var c;b.changedTouches&&b.changedTouches[0]?(c=b.changedTouches[0].clientX,
b=b.changedTouches[0].clientY):(c=b.clientX,b=b.clientY);a.elements.cursor.css("transform","translate("+c+"px, "+b+"px)")}).keydown(function(b){a.can_undo&&("z"==b.key||"Z"==b.key||90==b.keyCode)&&b.ctrlKey&&a.undo(b)}).on("touchstart",function(a){});h.on("pixel",function(a){$.map(a.pixels,function(a){p.setPixel(a.x,a.y,a.color,!1)});p.refresh();p.update(!0)});h.on("ACK",function(b){switch(b.ackFor){case "PLACE":if(!f.get("audio_muted")){var c=a.audio.cloneNode(!1);c.volume=parseFloat(f.get("alert.volume"));
c.play()}case "UNDO":0===v.getAvailable()&&v.setPlaceableText("PLACE"===b.ackFor?0:1)}});h.on("captcha_required",function(a){grecaptcha.reset();grecaptcha.execute();x("send","event","Captcha","Execute")});h.on("captcha_status",function(b){b.success?(b=a.pendingPixel,a.switch(b.color),a._place(b.x,b.y),x("send","event","Captcha","Accepted")):(l.show("Failed captcha verification"),x("send","event","Captcha","Failed"))});h.on("can_undo",function(b){document.body.classList.add("undo-visible");a.elements.undo.addClass("open");
a.can_undo=!0;!1!==a.undoTimeout&&clearTimeout(a.undoTimeout);a.undoTimeout=setTimeout(function(){document.body.classList.remove("undo-visible");a.elements.undo.removeClass("open");a.can_undo=!1;a.undoTimeout=!1},1E3*b.time)});a.elements.undo.click(a.undo);window.recaptchaCallback=function(a){h.send({type:"captcha",token:a});x("send","event","Captcha","Sent")};a.elements.palette.on("wheel",function(b){!0===f.get("scrollSwitchEnabled")&&(b=(a.color+(0<-40*b.originalEvent.deltaY?1:-1)*(!0===f.get("scrollSwitchDirectionInverted")?
-1:1))%a.palette.length,a.switch(-1>=b?a.palette.length-1:b))})},hexToRgb:function(a){return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null},getPaletteRGB:function(){var b=new Uint32Array(a.palette.length);$.map(a.palette,function(c,d){c=a.hexToRgb(c);b[d]=4278190080|c.b<<16|c.g<<8|c.r});return b}};return{init:a.init,update:a.update,place:a.place,switch:a.switch,setPalette:a.setPalette,getPaletteRGB:a.getPaletteRGB,setAutoReset:a.setAutoReset,
setNumberedPaletteEnabled:a.setNumberedPaletteEnabled,get color(){return a.color}}}(),A=function(){var a={elements:{lookup:$("#lookup"),prompt:$("#prompt")},handle:null,report:function(b,c,d){a.elements.prompt.empty().append($("\x3cp\x3e").addClass("text").css({fontWeight:800,marginTop:0}).text("Report pixel to moderator"),$("\x3cselect\x3e").append($("\x3coption\x3e").text("Rule #1: Hateful/derogatory speech or symbols"),$("\x3coption\x3e").text("Rule #2: Nudity, genitalia, or non-PG-13 content"),
$("\x3coption\x3e").text("Rule #3: Multi-account"),$("\x3coption\x3e").text("Rule #4: Botting"),$("\x3coption\x3e").attr("value","other").text("Other (specify below)")).css({width:"100%","margin-bottom":"1em"}),$("\x3ctextarea\x3e").attr("placeholder","Additional information (if applicable)").css({width:"100%",height:"5em"}).keydown(function(a){a.stopPropagation()}),$("\x3cdiv\x3e").addClass("button").text("Cancel").css({position:"fixed",bottom:20,left:30,width:66}).click(function(){a.elements.prompt.fadeOut(200)}),
$("\x3cbutton\x3e").addClass("button").text("Report").css({position:"fixed",bottom:20,right:30}).click(function(){this.disabled=!0;this.textContent="Sending...";var e=a.elements.prompt.find("select").val(),g=a.elements.prompt.find("textarea").val().trim(),f=e;if("other"===e){if(""===g){l.show("You must specify the details.");return}f=g}else""!==g&&(f+="; additional information: "+g);$.post("/report",{id:b,x:c,y:d,message:f},function(){l.show("Sent report!");a.elements.prompt.hide();a.elements.lookup.hide()}).fail(function(){l.show("Error sending report.")})})).fadeIn(200)},
hooks:[],registerHook:function(b){for(var c=[],d=0;d<arguments.length;++d)c[d-0]=arguments[d];return a.hooks.push.apply(a.hooks,[].concat($jscomp.arrayFromIterable($.map(c,function(a){return{id:a.id||"hook",name:a.name||"Hook",sensitive:a.sensitive||!1,get:a.get||function(){},css:a.css||{}}}))))},unregisterHook:function(b){return a.hooks=$.grep(a.hooks,function(a){return a.id!==b})},create:function(b){var c="true"===localStorage.getItem("hide_sensitive"),d=[];a._makeShell(b).find(".content").first().append(function(){return b?
$.map(a.hooks,function(a){var e=a.get(b),e="object"===typeof e?e:$("\x3cspan\x3e").text(e),e=$('\x3cdiv data-sensitive\x3d"'+a.sensitive+'"\x3e').append($("\x3cb\x3e").text(a.name+": "),e.css(a.css)).attr("id","lookuphook_"+a.id);a.sensitive&&(d.push(e),c&&e.css("display","none"));return e}):$("\x3cp\x3e").text("This pixel is background (was not placed by a user).")}).append(function(){if(!b)return"";if(1<=d.length){var a=$("\x3clabel\x3e").text("Hide sensitive information"),g=$('\x3cinput type\x3d"checkbox"\x3e').css("margin-top",
"10px");a.prepend(g);g.prop("checked",c);g.change(function(){var a=this;f.set("hide_sensitive",this.checked);d.forEach(function(b){b.css("display",a.checked?"none":"")})});return a}return""});a.elements.lookup.fadeIn(200)},_makeShell:function(b){return a.elements.lookup.empty().append($("\x3cdiv\x3e").addClass("content"),b&&t.isLoggedIn()?$("\x3cdiv\x3e").addClass("button").css("float","left").addClass("report-button").text("Report").click(function(){a.report(b.id,b.x,b.y)}):"",$("\x3cdiv\x3e").addClass("button").css("float",
"right").text("Close").click(function(){a.elements.lookup.fadeOut(200)}),b&&q.getOptions().use?$("\x3cdiv\x3e").addClass("button").css("float","right").text("Move Template Here").click(function(){q.queueUpdate({ox:b.x,oy:b.y})}):"")},runLookup:function(b,c){b=p.fromScreen(b,c);$.get("/lookup",{x:Math.floor(b.x),y:Math.floor(b.y)},function(b){b=b||!1;a.handle?a.handle(b):a.create(b)}).fail(function(){a._makeShell(!1).find(".content").first().append($("\x3cp\x3e").css("color","#c00").text("An error occurred, either you aren't logged in or you may be attempting to look up users too fast. Please try again in 60 seconds"));
a.elements.lookup.fadeIn(200)})},init:function(){a.registerHook({id:"coords",name:"Coords",get:function(a){return $("\x3ca\x3e").text("("+a.x+", "+a.y+")").attr("href",C.getLinkToCoords(a.x,a.y))}},{id:"username",name:"Username",get:function(a){return a.username}},{id:"time",name:"Time",get:function(a){var b=((new Date).getTime()-a.time)/1E3,d=(new Date(a.time)).toLocaleString();a=$("\x3cspan\x3e");a.attr("title",d);if(86400<b)return a.text(d);if(5>b)return a.text("just now");var d=Math.floor(b%60),
e=Math.floor(b/60)%60,b=Math.floor(b/3600);return a.text((10>b?"0"+b:b)+":"+(10>e?"0"+e:e)+":"+(10>d?"0"+d:d)+" ago")}},{id:"pixels",name:"Pixels",get:function(a){return a.pixel_count}},{id:"pixels_alltime",name:"Alltime Pixels",get:function(a){return a.pixel_count_alltime}});a.elements.lookup.hide();a.elements.prompt.hide();p.getRenderBoard().on("click",function(b){b.shiftKey&&(b.preventDefault(),a.runLookup(b.clientX,b.clientY))})},registerHandle:function(b){a.handle=b},clearHandle:function(){a.handle=
null}};return{init:a.init,registerHandle:a.registerHandle,registerHook:a.registerHook,unregisterHook:a.unregisterHook,runLookup:a.runLookup,clearHandle:a.clearHandle}}(),O=function(){var a={elements:{container:$("#drawers"),opener:$("#drawers-opener")},create:function(a,c,d,e){function b(){h.trigger("drawer-state-change",{isOpen:h.hasClass("open")})}var h=$(a);$(a+" \x3e .open").click(function(){h.toggleClass("open");b();f.set(d,h.hasClass("open")^e)});$(a+" .close").click(function(){h.removeClass("open");
b();f.set(d,0^e)});f.get(d)^e&&(h.addClass("open"),b());$(document.body).keydown(function(a){a.keyCode===c&&(h.toggleClass("open"),f.set(d,h.hasClass("open")^e),b())})},updateDropdown:function(){$("#drawers-opener-content").empty().append($("#drawers \x3e .drawer").map(function(){var b=$(this);return $("\x3cdiv\x3e").text(b.find(".open").text()).click(function(c){c.stopPropagation();b.toggleClass("open");a.elements.opener.removeClass("open");b.trigger("drawer-state-change",{isOpen:b.hasClass("open")})})}).get())},
init:function(){a.elements.opener.find(".open").click(function(b){a.elements.opener.toggleClass("open")});a.elements.container.on("DOMNodeInserted",function(b){$(b.target).hasClass("drawer")&&a.updateDropdown()});a.updateDropdown()}};return{create:a.create,init:a.init}}(),k=function(){return{init:function(){O.create("#info",73,"info_closed",!0);$("#audiotoggle")[0].checked=f.get("audio_muted");$("#audiotoggle").change(function(){f.set("audio_muted",this.checked)});var a=f.get("auto_reset");null===
a&&(a=!0);m.setAutoReset(a);$("#stickyColorToggle")[0].checked=!a;$("#stickyColorToggle").change(function(){m.setAutoReset(!this.checked)});$("#monospaceToggle").change(function(){f.set("monospace_lookup",this.checked);this.checked?$(".monoVal").addClass("useMono"):$(".monoVal").removeClass("useMono")})}}}(),l=function(){var a={elements:{alert:$("#alert")},show:function(b,c){c=void 0===c?!1:c;a.elements.alert.find(".text,.custWrapper").empty();a.elements.alert.find(".text").append(b);a.elements.alert.fadeIn(200);
!0===c?a.elements.alert.find(".default-control").hide():a.elements.alert.find(".default-control").show()},showElem:function(b,c){c=void 0===c?!1:c;a.elements.alert.find(".text,.custWrapper").empty();a.elements.alert.find(".custWrapper").append(b);a.elements.alert.fadeIn(200);!0===c?a.elements.alert.find(".default-control").hide():a.elements.alert.find(".default-control").show()},hide:function(){a.elements.alert.fadeOut(200)},init:function(){a.elements.alert.hide().find(".button").click(function(){a.elements.alert.fadeOut(200)});
h.on("alert",function(b){a.show(b.message)})}};return{init:a.init,show:a.show,hide:a.hide,showElem:a.showElem}}(),v=function(){var a={_available:-1,maxStacked:-1,_alertUpdateTimer:!1,elements:{stackCount:$("#placeableCount-bubble, #placeableCount-cursor"),txtAlertLocation:$("#txtAlertLocation"),rangeAlertVolume:$("#rangeAlertVolume"),lblAlertVolume:$("#lblAlertVolume"),btnForceAudioUpdate:$("#btnForceAudioUpdate"),themeSelect:$("#themeSelect")},themes:[{name:"Dark",location:"/themes/dark.css"}],init:function(){a._initThemes();
a._initStack();a._initAudio();var b=f.get("monospace_lookup");"undefined"===typeof b&&(f.set("monospace_lookup",!0),b=!0);$("#monospaceToggle").prop("checked",b);b&&$(".monoVal").addClass("useMono");b=f.get("alert_delay");"undefined"===typeof b&&(f.set("alert_delay","0"),b=0);$("#alertDelay").val(b);$("#alertDelay").change(function(){isNaN($(this).val())||f.set("alert_delay",$(this).val())});$("#alertDelay").keydown(function(a){switch(a.code||a.keyCode||a.which||a.key){case "KeyT":case 84:case "T":case "t":case "KeyEnter":case 13:$(this).blur()}});
$("#increasedZoomToggle").prop("checked",!0===f.get("increased_zoom"));$("#increasedZoomToggle").change(function(){var a=!0===$(this).prop("checked");f.set("increased_zoom",a)});$("#scrollSwitchToggle").prop("checked",!0===f.get("scrollSwitchEnabled"));$("#scrollSwitchToggle").change(function(){f.set("scrollSwitchEnabled",!0===this.checked)});$("#scrollDirectionToggle").prop("checked",!0===f.get("scrollSwitchDirectionInverted"));$("#scrollDirectionToggle").change(function(){f.set("scrollSwitchDirectionInverted",
!0===this.checked)});null==f.get("enableMiddleMouseSelect")&&f.set("enableMiddleMouseSelect",!0);$("#cbEnableMiddleMouseSelect").prop("checked",!0===f.get("enableMiddleMouseSelect")).change(function(){f.set("enableMiddleMouseSelect",!0===this.checked)});m.setNumberedPaletteEnabled(!0===f.get("enableNumberedPalette"));$("#cbNumberedPalette").prop("checked",!0===f.get("enableNumberedPalette")).change(function(){f.set("enableNumberedPalette",!0===this.checked);m.setNumberedPaletteEnabled(!0===this.checked)});
$(window).keydown(function(a){switch(a.key||a.which){case "Escape":case 27:a=$("#lookup, #prompt, #alert"),a.is(":visible")?a.fadeOut(200):m.switch(-1)}});var c=$("#info");if(c.hasClass("open"))c.find("iframe[data-lazysrc]").each(function(a,b){b.src=b.dataset.lazysrc;delete b.dataset.lazysrc});else c.on("drawer-state-change",function(a,b){!0===b.isOpen&&(a=$("#info iframe[data-lazysrc]"),a.length?a.each(function(a,b){b.src=b.dataset.lazysrc;delete b.dataset.lazysrc}):c.off("drawer-state-change"))})},
_initThemes:function(){for(var b=0;b<a.themes.length;b++)a.themes[b].element=$('\x3clink data-theme\x3d"'+b+'" rel\x3d"stylesheet" href\x3d"'+a.themes[b].location+'"\x3e'),a.elements.themeSelect.append($("\x3coption\x3e",{value:b,text:a.themes[b].name}));b=f.get("currentTheme");null==b||b>a.themes.length||-1>b?f.set("currentTheme",-1):(b=parseInt(b),-1!==b&&(a.themes[b].element.appendTo(document.head),a.elements.themeSelect.val(b)));a.elements.themeSelect.on("change",function(){var b=parseInt(this.value);
-1===b?(console.log("Default theme - should reset!"),$("*[data-theme]").remove(),f.set("currentTheme",-1)):(a.themes[b].element.appendTo(document.head),f.set("currentTheme",b))})},_initStack:function(){h.on("pixels",function(b){a.updateAvailable(b.count,b.cause)})},_initAudio:function(){var b=parseFloat(f.get("alert.volume"));isNaN(parseFloat(f.get("alert.volume")))?(b=1,f.set("alert.volume",1)):(b=parseFloat(f.get("alert.volume")),w.audioElem.volume=b);a.elements.lblAlertVolume.text((100*b>>0)+"%");
a.elements.rangeAlertVolume.val(b);f.get("alert.src")&&(a.updateAudio(f.get("alert.src")),a.elements.txtAlertLocation.val(f.get("alert.src")));w.audioElem.addEventListener("error",function(a){console.warn&&console.warn("An error occurred on the audioElem node: %o",a)});a.elements.txtAlertLocation.change(function(){!1!==a._alertUpdateTimer&&clearTimeout(a._alertUpdateTimer);a._alertUpdateTimer=setTimeout(function(b){a.updateAudio(b);a._alertUpdateTimer=!1},250,this.value)}).keydown(function(a){"Enter"!=
a.key&&13!==a.which||$(this).change();a.stopPropagation()});a.elements.btnForceAudioUpdate.click(function(){return a.elements.txtAlertLocation.change()});a.elements.rangeAlertVolume.change(function(){var b=parseFloat(a.elements.rangeAlertVolume.val());a.elements.lblAlertVolume.text((100*b>>0)+"%");f.set("alert.volume",b);w.audioElem.volume=b});$("#btnAlertAudioTest").click(function(){return w.audioElem.play()});$("#btnAlertReset").click(function(){a.updateAudio("notify.wav");a.elements.txtAlertLocation.val("")})},
updateAudio:function(a){try{a||(a="notify.wav"),w.audioElem.src=a,f.set("alert.src",a)}catch(c){l.show("Failed to update audio src, using default sound."),w.audioElem.src="notify.wav",f.set("alert.src","notify.wav")}},updateAvailable:function(b,c){0<b&&"stackGain"===c&&w.playAudio();a.setPlaceableText(b)},setMax:function(b){a.maxStacked=b+1},setPlaceableText:function(b){a.elements.stackCount.text(b+"/"+a.maxStacked)},getAvailable:function(){return a._available}};return{init:a.init,updateTimer:a.updateTimer,
updateAvailable:a.updateAvailable,getAvailable:a.getAvailable,setPlaceableText:a.setPlaceableText,setMax:a.setMax,updateAudio:a.updateAudio}}(),I=function(){var a=this,b={init:function(){Array.from(document.querySelectorAll(".panel-trigger")).forEach(function(a){a.addEventListener("click",function(a){if(!a.target)return console.debug("[PANELS:TRIGGER] No target?");var b=a.target.closest(".panel-trigger");b?(a=b.dataset.panel)&&a.trim()?(b=document.querySelector('.panel[data-panel\x3d"'+a.trim()+'"]'))?
(Array.from(document.querySelectorAll(".panel.open")).forEach(function(a){a.classList.remove("open");$(window).trigger("pxls:panel:closed",a.dataset.panel)}),b.classList.add("open"),document.body.classList.toggle("panel-left-open",b.classList.contains("left")),document.body.classList.toggle("panel-right-open",b.classList.contains("right")),$(window).trigger("pxls:panel:opened",a)):console.debug("[PANELS:TRIGGER] Bad descriptor? Got: %o",a):console.debug("[PANELS:TRIGGER] No descriptor? Elem: %o",
b):console.debug("[PANELS:TRIGGER] No trigger?")})});Array.from(document.querySelectorAll(".panel-closer")).forEach(function(a){a.addEventListener("click",function(a){if(!a.target)return console.debug("[PANELS:CLOSER] No target?");(a=a.target.closest(".panel"))?(a.classList.toggle("open",!1),$(window).trigger("pxls:panel:closed",[a.dataset.panel]),a.classList.contains("right")?document.body.classList.remove("panel-right-open"):document.body.classList.remove("panel-left-open")):console.debug("[PANELS:CLOSER] No panel?")})})},
isOpen:function(a){a instanceof HTMLElement||(a=document.querySelector('.panel[data-panel\x3d"'+a+'"]'));return a&&a.classList.contains("open")},_toggleOpenState:function(b,d){d=void 0===d?!0:d;b instanceof HTMLElement||(b=document.querySelector('.panel[data-panel\x3d"'+b+'"]'));b&&a._setOpenState(b,!b.classList.contains("open"),d)},_setOpenState:function(a,b,e){e=void 0===e?!0:e;b=!!b;a instanceof HTMLElement||(a=document.querySelector('.panel[data-panel\x3d"'+a+'"]'));a&&(b&&e&&document.querySelectorAll(".panel[data-panel]."+
(a.classList.contains("right")?"right":"left")+".open").forEach(function(a){return a.classList.remove("open")}),a.classList.toggle("open",b))}};return{init:b.init,open:function(a){return b._setOpenState(a,!0)},close:function(a){return b._setOpenState(a,!1)},toggle:function(a){return b._toggleOpenState(a)},isOpen:b.isOpen}}(),P=function(){var a={seenHistory:!1,stickToBottom:!0,repositionTimer:!1,nonceLog:[],chatban:{banStart:0,banEnd:0,banEndFormatted:"",timeLeft:0,timer:0},timeout:{ends:0,timer:0},
elements:{message_icon:$("#message-icon"),input:$("#txtChatContent"),body:$("#chat-body"),rate_limit_overlay:$(".chat-ratelimit-overlay"),rate_limit_counter:$("#chat-ratelimit"),chat_panel:$(".panel[data-panel\x3dchat]"),chat_hint:$("#chat-hint")},init:function(){h.on("chat_history",function(b){if(!a.seenHistory){b=$jscomp.makeIterator(b.messages.reverse());for(var c=b.next();!c.done;c=b.next())a._process(c.value);if(b=a.elements.body.find("li[data-nonce]").last()[0])a._doScroll(b),b.dataset.nonce&&
b.dataset.nonce!==f.get("chat-last_seen_nonce")&&a.elements.message_icon.addClass("has-notification");a.seenHistory=!0;a.addServerAction("History loaded at "+moment().format("MMM Do YYYY, hh:mm:ss A"))}});h.on("chat_message",function(b){a._process(b.message);a.elements.chat_panel.hasClass("open")||a.elements.message_icon.addClass("has-notification");if(a.stickToBottom){var c=a.elements.body.find('[data-nonce\x3d"'+b.message.nonce+'"]')[0];c&&(a.elements.chat_panel.hasClass("open")&&f.set("chat-last_seen_nonce",
b.message.nonce),a._doScroll(c))}});h.on("message_cooldown",function(b){a.timeout.ends=(new Date>>0)+1E3*(b.diff>>0)+1E3;a.elements.input.val(b.message);a.elements.input.blur();new Date>>0>a.timeout.ends?a.elements.rate_limit_overlay.fadeOut():a.elements.rate_limit_overlay.fadeIn();0<a.timeout.timer&&clearInterval(a.timeout.timer);a.timeout.timer=setInterval(function(){var b=(a.timeout.ends-(new Date>>0))/1E3>>0;a.elements.rate_limit_counter.text(b+"s");0>=b&&(a.elements.rate_limit_overlay.fadeOut(),
a.elements.rate_limit_counter.text(""),clearInterval(a.timeout.timer),a.timeout.timer=0)},100)});h.on("message_delete",function(a){return console.log("[message_delete] %o",a)});var b=function(b){clearInterval(a.timeout.timer);a.chatban.banStart=moment.now();a.chatban.banEnd=moment(b.expiry);a.chatban.banEndFormatted=a.chatban.banEnd.format("MMM Do YYYY, hh:mm:ss A");setTimeout(function(){clearInterval(a.chatban.timer);0<b.expiry-a.chatban.banStart&&!b.permanent?(a.elements.rate_limit_overlay.show(),
a.elements.rate_limit_counter.text("You have been banned from chat."),a.addServerAction("You are banned "+(b.permanent?"permanently from chat.":" until "+a.chatban.banEndFormatted)),a.chatban.timer=setInterval(function(){var b=a.chatban.banEnd-moment();0<b?(a.elements.rate_limit_overlay.show(),a.elements.rate_limit_counter.text("Chatban expires in "+(b/1E3>>0)+"s, at "+a.chatban.banEndFormatted)):(a.elements.rate_limit_overlay.hide(),a.elements.rate_limit_counter.text(""))},150)):b.permanent?(a.elements.rate_limit_overlay.show(),
a.elements.rate_limit_counter.text("You have been banned from chat."),a.addServerAction("You are banned from chat"+(b.permanent?" permanently.":" until "+a.chatban.banEndFormatted))):"chat_ban_state"!==b.type&&(a.elements.rate_limit_overlay.hide(),a.elements.rate_limit_counter.text(""),a.addServerAction("You have been unbanned from chat."))},0)};h.on("chat_ban",b);h.on("chat_ban_state",b);var c=function(a,b){"USER"!==t.getRole()?(a.classList.add("purged"),a.setAttribute("title","Purged by "+b.initiator+
" with reason: "+(b.reason||"none provided")),a.dataset.purgedBy=b.initiator):a.remove()};h.on("chat_purge",function(b){var e=Array.from(a.elements.body[0].querySelectorAll('.chat-line[data-author\x3d"'+b.target+'"]'));if(Array.isArray(e)&&e.length){e.sort(function(a,b){return(a.dataset.date>>0)-(b.dataset.date>>0)});for(var d=0;d<b.amount;d++){var f=e.pop();if(f)c(f,b);else break}}else console.log(e,"was not an array-like, or was empty.");2147483647<=b.amount?a.addServerAction(b.initiator+" purged all messages from "+
b.target+"."):a.addServerAction(b.amount+" message"+(1!==b.amount?"s":"")+" from "+b.target+" were purged by "+b.initiator+".")});h.on("chat_purge_specific",function(b){var e=[];b.nonces&&b.nonces.length&&b.nonces.forEach(function(b){(b=a.elements.body.find('.chat-line[data-nonce\x3d"'+b+'"]')[0])&&e.push(b)});e.length&&(e.forEach(function(a){return c(a,b)}),t.getUsername().toLowerCase().trim()===b.target.toLowerCase().trim()&&a.addServerAction(b.nonces.length+" message"+(1!==b.nonces.length?"s were":
" was")+" purged by "+b.initiator))});h.send({type:"ChatbanState"});h.send({type:"ChatHistory"});a.elements.rate_limit_overlay.hide();var d=[["tempban","/tempban  USER  BAN_LENGTH  SHOULD_PURGE  BAN_REASON"],["permaban","/permaban  USER  SHOULD_PURGE  BAN_REASON"],["purge","/purge  USER  PURGE_AMOUNT  PURGE_REASON"]];a.elements.input.on("keydown",function(b){b.stopPropagation();var c=a.elements.input[0].value.trim();if(("Enter"==b.originalEvent.key||13===b.originalEvent.which)&&!b.shiftKey)if(b.preventDefault(),
c.startsWith("/")&&"USER"!==t.getRole())switch(b=c.substr(1).split(" "),b.shift().toLowerCase().trim()){case "permaban":if(3>b.length)b[0]&&"help"===b[0].toLowerCase()?a.showHint("/permaban USER SHOULD_PURGE BAN_REASON\n/permaban help\n    USER:         The username\n    SHOULD_PURGE: (1|0) Whether or not to remove all chat messages from the user\n    BAN_REASON:   The reason for the ban\n\n    /permaban GlowingSocc 1 just generally don't like 'em\n    /permaban GlowingSocc 0 time for you to go."):
a.showHint("Missing arguments.\n/permaban USER SHOULD_PURGE BAN_REASON\n/permaban help",!0);else{var e=b.shift(),c=b.shift();b=b.join(" ");if(isNaN(c))return a.showHint("Invalid shouldPurge. Expected 1 or 0, got "+c,!0);a.elements.input[0].disabled=!0;$.post("/admin/chatban",{who:e,type:"perma",reason:b,removalAmount:c>>0?-1:0,banLength:0},function(){l.show("Chatban initiated");a.elements.input[0].value="";a.elements.input[0].disabled=!1}).fail(function(){l.show("Failed to chatban");a.elements.input[0].disabled=
!1})}break;case "tempban":if(4>b.length)b[0]&&"help"===b[0].toLowerCase()?a.showHint("/tempban USER BAN_LENGTH SHOULD_PURGE BAN_REASON\n/tempban help\n    USER:         The username\n    BAN_LENGTH:   The banlength in seconds\n    SHOULD_PURGE: (1|0) Whether or not to remove all chat messages from the user\n    BAN_REASON:   The reason for the ban\n\n    /tempban GlowingSocc 600 1 just generally don't like 'em\n    /tempban GlowingSocc 60 0 take a time out."):a.showHint("Missing arguments.\n/tempban USER BAN_LENGTH SHOULD_PURGE BAN_REASON\n/tempban help",
!0);else{var e=b.shift(),d=b.shift()>>0,c=b.shift();b=b.join(" ");if(isNaN(c))return a.showHint("Invalid shouldPurge. Expected 1 or 0, got "+c,!0);c=!!(c>>0);if(0>=d)return a.showHint("Invalid banLength. Should be \x3e0",!0);$.post("/admin/chatban",{who:e,type:"temp",reason:b,removalAmount:c?-1:0,banLength:d},function(){l.show("Chatban initiated");a.elements.input[0].value="";a.elements.input[0].disabled=!1}).fail(function(){l.show("Failed to chatban");a.elements.input[0].disabled=!1})}break;case "purge":if(3>
b.length)b[0]&&"help"===b[0].toLowerCase()?a.showHint("/purge USER PURGE_AMOUNT PURGE_REASON\n/purge help\n    USER:         The username\n    PURGE_AMOUNT: The amount of messages to purge\n    PURGE_REASON: The reason for the purge\n\n    /purge GlowingSocc 10 spam"):a.showHint("Missing arguments.\n/purge USER PURGE_AMOUNT PURGE_REASON\n/purge help",!0);else{c=b.shift();e=b.shift();b=b.join(" ");if(isNaN(e))return a.showHint("Invalid purgeAmount. Expected a number, got "+e,!0);$.post("/admin/chatPurge",
{who:c,amount:e>>0,reason:b},function(){l.show("Chatpurge initiated");a.elements.input[0].value="";a.elements.input[0].disabled=!1}).fail(function(){l.show("Failed to chatpurge");a.elements.input[0].disabled=!1})}}else a._send(a.elements.input[0].value),a.elements.input.val("");else if("Tab"==b.originalEvent.key||9==b.originalEvent.which)b.stopPropagation(),b.preventDefault()}).on("keyup",function(b){var c=a.elements.input[0].value.trim();if(0==c.length)return a.showHint("");if(("Enter"!=b.originalEvent.key&&
13!==b.originalEvent.which||b.originalEvent.shiftKey)&&c.startsWith("/")&&"USER"!==t.getRole()){var e=c.substr(1).split(" ").shift(),f=[];d.forEach(function(a){a[0].startsWith(e)&&f.push(a[1])});f.length&&a.showHint(f.join("\n"))}});$(window).on("pxls:panel:opened",function(b,c){"chat"===c&&(a.elements.message_icon.removeClass("has-notification"),(b=a.elements.body.find("[data-nonce]").last()[0])&&f.set("chat-last_seen_nonce",b.dataset.nonce),t.isLoggedIn()?(a.elements.rate_limit_overlay.hide(),a.elements.rate_limit_counter.text("")):
(a.elements.rate_limit_overlay.show(),a.elements.rate_limit_counter.text("You must be logged in to chat.")))});$(window).on("mouseup",function(a){var b=a.target,c=document.querySelector(".popup");c&&(a.originalEvent&&a.originalEvent.target&&(b=a.originalEvent.target),b&&(b.closest(".popup")||c.remove()))});$(window).on("resize",function(b){var c=document.querySelector(".popup.panels[data-popup-for]");if(c){var e=document.querySelector('.chat-line[data-nonce\x3d"'+c.dataset.popupFor+'"] [data-action\x3d"actions-panel"]');
if(!e)return console.warn("no cog");a.repositionTimer&&clearTimeout(a.repositionTimer);a.repositionTimer=setTimeout(function(){a._positionPopupRelativeToX(c,e);a.repositionTimer=!1},25)}});a.elements.body[0].addEventListener("wheel",function(a){(a=document.querySelector(".popup.panels"))&&a.remove()});$("#cbChatSettings24h").prop("checked",!0===f.get("chat.24h")).on("change",function(a){f.set("chat.24h",!!this.checked)});$("#cbChatSettingsBadgesToggle").prop("checked",!0===f.get("chat.text-icons-enabled")).on("change",
function(a){f.set("chat.text-icons-enabled",!!this.checked)});a.elements.body.on("scroll",function(b){b=a.elements.body[0];a.stickToBottom=a._numWithinDrift(b.scrollTop>>0,b.scrollHeight-b.offsetHeight,2)})},_numWithinDrift:function(a,c,d){return a>=c-d&&a<=c+d},showHint:function(b,c){a.elements.chat_hint.toggleClass("text-red",!0===(void 0===c?!1:c)).text(b)},addServerAction:function(b){var c=moment();b=crel("li",{"class":"chat-line server-action"},crel("span",{title:c.format("MMM Do YYYY, hh:mm:ss A")},
c.format("hh:mm:ss A")),document.createTextNode(" - "),crel("span",{"class":"content"},b));a.elements.body.append(b);a.stickToBottom&&a._doScroll(b)},_send:function(a){h.send({type:"ChatMessage",message:a})},_process:function(b){if(b.nonce){if(a.nonceLog.includes(b.nonce))return;a.nonceLog.unshift(b.nonce);50<a.nonceLog.length&&a.nonceLog.pop()}var c=moment.unix(b.date),d=crel("span",{"class":"badges"});Array.isArray(b.badges)&&b.badges.forEach(function(a){switch(a.type){case "text":if(!0!==f.get("chat.text-icons-enabled"))break;
crel(d,crel("span",{"class":"text-badge",title:a.tooltip||""},a.displayName||""),document.createTextNode(" "));break;case "icon":crel(d,crel("i",{"class":(a.cssIcon||"")+" icon-badge",title:a.tooltip||""},document.createTextNode(" ")),document.createTextNode(" "))}});a.elements.body.append(crel("li",{"data-nonce":b.nonce,"data-author":b.author,"data-date":b.date,"data-badges":JSON.stringify(b.badges||[]),"class":"chat-line"},crel("span",{"class":"actions"},crel("i",{"class":"fas fa-cog","data-action":"actions-panel",
title:"Actions",onclick:a._popUserPanel})),crel("span",{title:c.format("MMM Do YYYY, hh:mm:ss A")},c.format(!0===f.get("chat.24h")?"HH:mm":"hh:mm A")),document.createTextNode(" "),d,document.createTextNode(" "),crel("span",{"class":"user",onclick:a._popUserPanel},b.author),document.createTextNode(": "),crel("span",{"class":"content"},b.message_raw),document.createTextNode(" ")))},_popUserPanel:function(b){if(this&&this.closest){b=this.closest(".chat-line[data-nonce]");if(!b)return console.warn("no closets chat-line on self: %o",
this);var c=b.dataset.nonce,d=[];try{d=JSON.parse(b.dataset.badges)}catch(S){}var e=crel("span",{"class":"badges"});d.forEach(function(a){switch(a.type){case "text":crel(e,crel("span",{"class":"text-badge",title:a.tooltip||""},a.displayName||""),document.createTextNode(" "));break;case "icon":crel(e,crel("i",{"class":(a.cssIcon||"")+" icon-badge",title:a.tooltip||""},document.createTextNode(" ")),document.createTextNode(" "))}});var d=crel("div",{"class":"popup panels","data-popup-for":c}),g=crel("div",
{"class":"panels-wrapper"}),h=crel("header",{style:"text-align: center;"},crel("div",{"class":"left"},crel("i",{"class":"fas fa-times text-red",onclick:function(){if(this&&this.closest){var a=this.closest(".popup.panels");a&&a.remove()}}})),crel("span",b.dataset.author,e),crel("div",{"class":"right"})),k=crel("div",{"class":"panel-grow left-pane"}),l=crel("div",{"class":"panel-shrink right-pane"}),m=crel("ul",{"class":"actions-list"});crel("ul",{"class":"popup-actions"});var p=crel("li",{"class":"text-red",
"data-action":"report","data-nonce":c,onclick:a._handleActionClick},"Report"),n=crel("li",{"data-action":"chatban","data-nonce":c,onclick:a._handleActionClick},"Chat (un)ban"),q=crel("li",{"data-action":"purge","data-nonce":c,onclick:a._handleActionClick},"Purge User"),r=crel("li",{"data-action":"delete","data-nonce":c,onclick:a._handleActionClick},"Delete"),c=crel("li",{"data-action":"lookup","data-nonce":c,onclick:a._handleActionClick},"Mod Lookup");crel(k,crel("p",{"class":"popup-timestamp-header"},
moment.unix(b.dataset.date>>0).format("MMM Do YYYY, "+(!0===f.get("chat.24h")?"HH:mm:ss":"hh:mm:ss A"))));crel(k,crel("p",{style:"margin-top: 3px; margin-left: 3px; text-align: left;"},b.querySelector(".content").textContent));crel(m,p);["MODERATOR","DEVELOPER","ADMIN","TRIALMOD"].includes(t.getRole())&&(crel(m,r),crel(m,q),crel(m,n),crel(m,c));crel(l,m);b=crel(d,h,crel(g,k,l));document.body.appendChild(b);a._positionPopupRelativeToX(b,this)}},_positionPopupRelativeToX:function(a,c){var b=document.body.getBoundingClientRect();
c=c.getBoundingClientRect();var e=a.getBoundingClientRect();a.style.left=c.left<e.width/2?(c.left>>0)+"px":(c.left+(c.width/2>>0)-(e.width/2>>0)>>0)+"px";a.style.top=c.top+c.height+2+"px";e=a.getBoundingClientRect();e.bottom>b.bottom&&(a.style.bottom="2px",a.style.top=null);e.top<b.top&&(a.style.top="2px",a.style.bottom=null);e.right>b.right&&(a.style.right="2px",a.style.left=null);e.left<b.left&&(a.style.left="2px",a.style.right=null)},_handleActionClick:function(b){var c=this;if(!this.dataset)return console.trace("onClick attached to invalid object");
var d=a.elements.body.find('.chat-line[data-nonce\x3d"'+this.dataset.nonce+'"]')[0];if(!d&&!this.dataset.target)return console.warn("no chatLine/target? searched for nonce %o",this.dataset.nonce);var e=!!d;b=e?d.querySelector(".content").textContent:"";var f=e?d.dataset.author:this.dataset.target;$(".popup").remove();switch(this.dataset.action.toLowerCase().trim()){case "report":var h=crel("button",{"class":"button",style:"position: initial;",type:"submit"},"Report"),k=crel("textarea",{placeholder:"Enter a reason for your report",
style:"width: 100%; border: 1px solid #999;",required:"true",onkeydown:function(a){return a.stopPropagation()}}),m=crel("form",{"class":"report chat-report","data-chat-nonce":this.dataset.nonce},crel("h3","Chat Report"),crel("p","Use this form to report chat offenses."),crel("p",{style:"font-size: 1rem !important;"},"You are reporting a chat message from ",crel("span",{style:"font-weight: bold"},f),crel("span",{title:b},' with the content "'+b.substr(0,60)+(60<b.length?"...":"")+'"')),k,crel("div",
{style:"text-align: right"},crel("button",{"class":"button",style:"position: initial; margin-right: .25rem",type:"button",onclick:function(){l.hide();m.remove()}},"Cancel"),h));m.onsubmit=function(a){a.preventDefault();h.disabled=!0;if(!c.dataset.nonce)return console.error("!! No nonce to report? !!",c);$.post("/reportChat",{nonce:c.dataset.nonce,report_message:k.value},function(){m.remove();l.show("Sent report!")}).fail(function(){l.show("Error sending report.");h.disabled=!1})};l.showElem(m,!0);
break;case "chatban":var p=crel("textarea",{placeholder:"Enter a reason for the (un)ban.",required:"true",onkeydown:function(a){return a.stopPropagation()}}),n=crel("input",{type:"text",required:"true",placeholder:"-1 for all",onkeydown:function(a){return a.stopPropagation()}}),q=crel("label",{"class":"error-label"}),r=crel("input",{type:"text",value:"600",onkeydown:function(a){return a.stopPropagation()}}),u=crel("label",{"class":"error-label"}),v=crel("input",{type:"radio",name:"rbBanType","data-type":"temp"}),
d=crel("input",{type:"radio",name:"rbBanType","data-type":"perma"}),w=crel("input",{type:"radio",name:"rbBanType","data-type":"unban"}),y=crel("label",{"class":"error-label"}),A=crel("div",{"class":"hidden"},crel("h5","Ban Length:"),crel("label","Banlength (seconds): ",r),crel("br"),u);d.onchange=v.onchange=w.onchange=function(a){return A.classList.toggle("hidden",!v.checked)};b=e?crel("table",{"class":"chatmod-table"},crel("tr",crel("th","Nonce: "),crel("td",this.dataset.nonce)),crel("tr",crel("th",
"Message: "),crel("td",{title:b},""+b.substr(0,120)+(120<b.length?"...":"")))):crel("table",{"class":"chatmod-table"},crel("tr",crel("th","User: "),crel("td",f)));var x=crel("form",{"class":"chatmod-container","data-chat-nonce":this.dataset.nonce},crel("h3","Chatban"),crel("h5",e?"Message:":"Banning:"),b,crel("h5","Ban Type"),crel("div",{"class":"rbgroup"},crel("label",v,"Temporary Ban"),crel("label",d,"Permanent Ban"),crel("label",w,"Unban")),y,A,crel("h5",{style:"margin-left: -1rem"},"(Un)ban Reason"),
crel("div",p),crel("h5","Message Removal"),crel("div",crel("label",{required:"true"},"Removal Ammount: ",n),crel("br"),q),crel("div",{"class":"buttons"},crel("button",{"class":"button",type:"button",onclick:function(){l.hide();x.remove()}},"Cancel"),crel("button",{"class":"button"},"Ban")));x.onsubmit=function(a){a.preventDefault();a=(a=x.querySelector("[name\x3drbBanType]:checked"))?a.dataset.type:!1;if(!1===a)y.innerHTML="Ban Type is required";else if(y.innerHTML="",/^-?[0-9]+$/.test(n.value)){q.innerHTML=
"";if("temp"===a.toLowerCase().trim())if(/^-?[0-9]+$/.test(r.value))u.innerHTML="";else{u.innerHTML="Invalid banlength";return}a={type:a,reason:p.value,removalAmount:n.value,banLength:r.value||0};e?a.nonce=c.dataset.nonce:a.who=f;$.post("/admin/chatban",a,function(){x.remove();l.show("Chatban initiated")}).fail(function(){l.show("Error occurred while chatbanning")})}else q.innerHTML="Invalid removal amount"};l.showElem(x,!0);break;case "delete":d=crel("button",{"class":"button"},"Delete");d.onclick=
function(){$.post("/admin/delete",{nonce:c.dataset.nonce},function(){B.remove();l.hide()}).fail(function(){l.show("Failed to delete")})};var B=crel("div",{"class":"chatmod-container"},crel("h3","Delete Message"),crel("h5","Message:"),crel("table",crel("tr",crel("th","Nonce: "),crel("td",this.dataset.nonce)),crel("tr",crel("th","User: "),crel("td",f)),crel("tr",crel("th","Message: "),crel("td",{title:b},""+b.substr(0,120)+(120<b.length?"...":"")))),crel("div",{"class":"buttons"},crel("button",{"class":"button",
type:"button",onclick:function(){B.remove();l.hide()}},"Cancel"),d));l.showElem(B,!0);break;case "purge":var z=crel("input",{type:"text",required:"true",placeholder:"-1 for all",onkeydown:function(a){return a.stopPropagation()}}),H=crel("label",{"class":"hidden error-label"}),F=crel("input",{type:"text",required:"true",onkeydown:function(a){return a.stopPropagation()}}),E=crel("label",{"class":"hidden error-label"}),d=crel("button",{"class":"button",type:"submit"},"Purge");b=e?crel("table",crel("tr",
crel("th","Nonce: "),crel("td",this.dataset.nonce)),crel("tr",crel("th","Message: "),crel("td",{title:b},""+b.substr(0,120)+(120<b.length?"...":"")))):crel("table",{"class":"chatmod-table"},crel("tr",crel("th","User: "),crel("td",f)));var C=crel("form",{"class":"chatmod-container"},crel("h3","Purge User"),crel("h5","Selected Message"),b,crel("div",crel("h5","Number of messages to purge"),z,crel("br"),H),crel("div",crel("h5","Purge Reason"),F,crel("br"),E),crel("div",{"class":"buttons"},crel("button",
{"class":"button",type:"button",onclick:function(){C.remove();l.hide()}},"Cancel"),d));C.onsubmit=function(a){a.preventDefault();/^-?[0-9]+$/.test(z.value)?(H.innerHTML="",0===z.value.trim().length?E.innerHTML="Invalid reason":(E.innerHTML="",z.value>>0?(H.innerHTML="",$.post("/admin/chatPurge",{who:f,amount:z.value,reason:F.value},function(){C.remove();l.show("User purged")}).fail(function(){l.show("Error sending purge.")})):H.innerHTML="Value must be -1 or \x3e0")):H.innerHTML="Invalid purge amount"};
l.show(C,!0);break;case "lookup":t.admin&&t.admin.checkUser&&t.admin.checkUser.check&&t.admin.checkUser.check(f)}},_doScroll:function(a){try{a.scrollIntoView({block:"nearest",inline:"nearest"})}catch(c){a.scrollIntoView(!1)}}};return{init:a.init,_handleActionClick:a._handleActionClick}}(),w=function(){var a={elements:{palette:$("#palette"),timer_bubble:$("#cd-timer-bubble"),timer_overlay:$("#cd-timer-overlay"),timer:null},isOverlay:!1,hasFiredNotification:!0,cooldown:0,runningTimer:!1,focus:!0,audio:new Audio("notify.wav"),
title:"",cooledDown:function(){return a.cooldown<(new Date).getTime()},update:function(b){var c=(a.cooldown-(new Date).getTime()-1)/1E3;!1===a.runningTimer&&(a.isOverlay=!0===f.get("auto_reset"),a.elements.timer=a.isOverlay?a.elements.timer_overlay:a.elements.timer_bubble,a.elements.timer_bubble.hide(),a.elements.timer_overlay.hide());a.status&&a.elements.timer.text(a.status);var d=parseInt(f.get("alert_delay"));0>d&&c<Math.abs(d)&&!a.hasFiredNotification&&(a.playAudio(),a.focus||K.show("Your next pixel will be available in "+
Math.abs(d)+" seconds!"),setTimeout(function(){v.setPlaceableText(1)},1E3*c),a.hasFiredNotification=!0);if(0<c){a.elements.timer.show();a.isOverlay&&(a.elements.palette.css("overflow-x","hidden"),a.elements.timer.css("left",a.elements.palette.scrollLeft()+"px"));c++;var e=Math.floor(c%60),e=10>e?"0"+e:e,c=Math.floor(c/60),c=10>c?"0"+c:c;a.elements.timer.text(c+":"+e);document.title="["+c+":"+e+"] "+a.title;if(!a.runningTimer||b)a.runningTimer=!0,setTimeout(function(){a.update(!0)},1E3)}else a.runningTimer=
!1,document.title=a.title,a.isOverlay&&(a.elements.palette.css("overflow-x","auto"),a.elements.timer.css("left","0")),a.elements.timer.hide(),0<d?setTimeout(function(){a.playAudio();a.focus||K.show("Your next pixel has been available for "+d+" seconds!");v.setPlaceableText(1);a.hasFiredNotification=!0},1E3*d):a.hasFiredNotification||(a.playAudio(),a.focus||K.show("Your next pixel is available!"),v.setPlaceableText(1),a.hasFiredNotification=!0)},init:function(){a.title=document.title;a.elements.timer_bubble.hide();
a.elements.timer_overlay.hide();$(window).focus(function(){a.focus=!0}).blur(function(){a.focus=!1});setTimeout(function(){a.cooledDown()&&0===v.getAvailable()&&v.setPlaceableText(1)},250);h.on("cooldown",function(b){a.cooldown=(new Date).getTime()+1E3*b.wait;a.hasFiredNotification=0===b.wait;a.update()})},playAudio:function(){f.get("audio_muted")||a.audio.play()}};return{init:a.init,cooledDown:a.cooledDown,playAudio:a.playAudio,audioElem:a.audio}}(),C=function(){var a={elements:{coordsWrapper:$("#coords"),
coords:$("#coords .coords-text"),lockIcon:$("#coords .icon-lock")},mouseCoords:null,init:function(){function b(b){b=p.fromScreen(b.clientX,b.clientY);a.mouseCoords=b;a.elements.coords.text("("+(b.x|0)+", "+(b.y|0)+")");a.elements.coordsWrapper.is(":visible")||a.elements.coordsWrapper.fadeIn(200)}function c(b){b=p.fromScreen(b.changedTouches[0].clientX,b.changedTouches[0].clientY);a.mouseCoords=b;a.elements.coords.text("("+(b.x|0)+", "+(b.y|0)+")");a.elements.coordsWrapper.is(":visible")||a.elements.coordsWrapper.fadeIn(200)}
a.elements.coordsWrapper.hide();var d=p.getRenderBoard()[0];d.addEventListener("pointermove",b,{passive:!1});d.addEventListener("mousemove",b,{passive:!1});d.addEventListener("touchstart",c,{passive:!1});d.addEventListener("touchmove",c,{passive:!1});$(window).keydown(function(b){b.ctrlKey||"c"!==b.key&&"C"!==b.key&&67!==b.keyCode||!navigator.clipboard||!a.mouseCoords||(navigator.clipboard.writeText(a.getLinkToCoords(a.mouseCoords.x,a.mouseCoords.y)),a.elements.coordsWrapper.addClass("copyPulse"),
setTimeout(function(){a.elements.coordsWrapper.removeClass("copyPulse")},200))})},getLinkToCoords:function(a,c){a=void 0===a?0:a;c=void 0===c?0:c;var b="";n.has("template")?b+="\x26template\x3d"+n.get("template"):0;n.has("tw")?b+="\x26tw\x3d"+n.get("tw"):0;n.has("oo")?b+="\x26oo\x3d"+n.get("oo"):0;n.has("ox")?b+="\x26ox\x3d"+n.get("ox"):0;n.has("oy")?b+="\x26oy\x3d"+n.get("oy"):0;return location.origin+"/#x\x3d"+Math.floor(a)+"\x26y\x3d"+Math.floor(c)+"\x26scale\x3d20"+b}};return{init:a.init,getLinkToCoords:a.getLinkToCoords,
lockIcon:a.elements.lockIcon}}(),t=function(){var a={elements:{users:$("#online"),userInfo:$("#userinfo"),loginOverlay:$("#login-overlay"),userMessage:$("#user-message"),prompt:$("#prompt"),signup:$("#signup")},role:"USER",pendingSignupToken:null,loggedIn:!1,username:"",getRole:function(){return a.role},getUsername:function(){return a.username},signin:function(){var b=f.get("auth_respond");b&&(f.remove("auth_respond"),b.signup?(a.pendingSignupToken=b.token,a.elements.signup.fadeIn(200)):h.reconnectSocket(),
a.elements.prompt.fadeOut(200))},isLoggedIn:function(){return a.loggedIn},webinit:function(b){a.elements.loginOverlay.find("a").click(function(c){c.preventDefault();a.elements.prompt.empty().append($("\x3ch1\x3e").html("Sign\x26nbsp;in\x26nbsp;with..."),$("\x3cul\x3e").append($.map(b.authServices,function(a){return $("\x3cli\x3e").append($("\x3ca\x3e").attr("href","/signin/"+a.id+"?redirect\x3d1").text(a.name).click(function(a){window.open(this.href,"_blank")?a.preventDefault():f.set("auth_same_window",
!0)}))})),$("\x3cdiv\x3e").addClass("button").text("Close").css({position:"fixed",bottom:20,right:30,width:55}).click(function(){a.elements.prompt.fadeOut(200)})).fadeIn(200)})},wsinit:function(){f.get("auth_proceed")&&(f.remove("auth_proceed"),a.signin())},doSignup:function(){a.pendingSignupToken&&$.post({type:"POST",url:"/signup",data:{token:a.pendingSignupToken,username:a.elements.signup.find("input").val()},success:function(){a.elements.signup.find("#error").text("");a.elements.signup.find("input").val("");
a.elements.signup.fadeOut(200);h.reconnectSocket();a.pendingSignupToken=null},error:function(b){a.elements.signup.find("#error").text(b.responseJSON.message)}})},init:function(){a.elements.userMessage.hide();a.elements.signup.hide();a.elements.signup.find("input").keydown(function(b){b.stopPropagation();"Enter"!=b.key&&13!==b.which||a.doSignup()});a.elements.signup.find("#signup-button").click(a.doSignup);a.elements.users.hide();a.elements.userInfo.hide();a.elements.userInfo.find(".logout").click(function(b){b.preventDefault();
$.get("/logout",function(){a.elements.userInfo.fadeOut(200);a.elements.userMessage.fadeOut(200);a.elements.loginOverlay.fadeIn(200);window.deInitAdmin&&window.deInitAdmin();a.loggedIn=!1;h.reconnectSocket()})});$(window).bind("storage",function(b){"auth"==b.originalEvent.key&&(f.remove("auth"),a.signin())});h.on("users",function(b){a.elements.users.text(b.count+" online").fadeIn(200)});h.on("session_limit",function(a){h.close();l.show("Too many sessions open, try closing some tabs.")});h.on("userinfo",
function(b){var c=!1,d=$("\x3cdiv\x3e").addClass("ban-alert-content");a.username=b.username;a.loggedIn=!0;a.elements.loginOverlay.fadeOut(200);a.elements.userInfo.find("span.name").text(b.username);"ip"==b.method?a.elements.userInfo.hide():a.elements.userInfo.fadeIn(200);a.role=b.role;"BANNED"==a.role?(c=!0,d.append($("\x3cp\x3e").text("You are permanently banned."))):!0===b.banned?(c=!0,d.append($("\x3cp\x3e").text("You are temporarily banned and will not be allowed to place until "+(new Date(b.banExpiry)).toLocaleString()))):
-1!=["TRIALMOD","MODERATOR","DEVELOPER","ADMIN"].indexOf(a.role)?(window.deInitAdmin&&window.deInitAdmin(),$.getScript("admin/admin.js").done(function(){window.initAdmin({socket:h,user:t,place:m,alert:l,lookup:A,chat:P,cdOverride:b.cdOverride},function(b){return a.admin=b})})):window.deInitAdmin&&window.deInitAdmin();c?(a.elements.userMessage.show().text("You can contact us using one of the links in the info menu.").fadeIn(200),d.append($("\x3cp\x3e").text("If you think this was an error, please contact us using one of the links in the info tab.")).append($("\x3cp\x3e").append("Ban reason:")).append($("\x3cp\x3e").append(b.ban_reason)),
l.showElem(d),window.deInitAdmin&&window.deInitAdmin()):a.elements.userMessage.hide();instaban&&z.shadow(5);x("send","event","Auth","Login",b.method)})}};return{init:a.init,getRole:a.getRole,getUsername:a.getUsername,webinit:a.webinit,wsinit:a.wsinit,isLoggedIn:a.isLoggedIn,get admin(){return a.admin||!1}}}(),K=function(){return{init:function(){try{Notification.requestPermission()}catch(a){console.log("Notifications not available")}},show:function(a){try{(new Notification("pxls.space",{body:a,icon:"favicon.ico"})).onclick=
function(){parent.focus();window.focus();this.close()}}catch(b){console.log("No notifications available!")}}}}();n.init();p.init();M.init();N.init();O.init();A.init();q.init();z.init();J.init();m.init();k.init();l.init();w.init();v.init();I.init();C.init();t.init();K.init();P.init();p.start();return{ls:f,ss:E,query:n,heatmap:{clear:M.clear},virginmap:{clear:N.clear},uiHelper:{updateAudio:v.updateAudio},template:{update:function(a){q.queueUpdate(a)},normalize:function(a,b){return q.normalizeTemplateObj(a,
void 0===b?!0:b)}},lookup:{registerHook:function(){return A.registerHook.apply(A,[].concat($jscomp.arrayFromIterable(arguments)))},unregisterHook:function(){return A.unregisterHook.apply(A,[].concat($jscomp.arrayFromIterable(arguments)))}},centerBoardOn:function(a,b){p.centerOn(a,b)},updateTemplate:function(a){q.queueUpdate(a)},alert:function(a){l.show($("\x3cspan\x3e").text(a).html())},doPlace:function(){z.me(3)},attemptPlace:function(){z.me(3)},banme:function(){z.me(4)}}}();